(function(b){function e(){this._callbacks={}}e.prototype.on=function(f,h,g){c.checkEventName(f);if(!this._callbacks[f]){this._callbacks[f]=[]}this._callbacks[f].push(this._wrapCallback(h,f,g));return this};e.prototype.off=function(f,g){if(typeof(f)=="undefined"){for(var f in this._callbacks){this._removeAllCallbacks(f)}return this}if(!this._callbacks[f]){return this}if(typeof(g)=="undefined"){this._removeAllCallbacks(f);return this}this._eachCallback(f,function(i,h){if(i.callback===g){this._callbacks[f].splice(h,1);return false}});if(this._callbacks[f].length<=0){this._removeAllCallbacks(f)}return this};e.prototype.emit=function(f){var g=Array.prototype.slice.call(arguments,1);this._fireCallbacks(this._wrapEvent(f),g);return this};e.prototype._fireCallbacks=function(f,g){this._eachCallback(f.eventName,function(i,h){if(f.shouldFire(i)&&i.shouldBeFired(f)){i.callIt.apply(i,g)}})};e.prototype._eachCallback=function(g,k){if(!this._callbacks[g]){return this}var f=null;var j=this._callbacks[g].length;for(var h=0;h<j;h++){f=k.call(this,this._callbacks[g][h],h);if(f===false){h-=1}else{if(f===true){break}}if(this._callbacks[g].length<=0){return this}}return this};e.prototype._removeAllCallbacks=function(f){delete this._callbacks[f]};e.prototype._removeCallback=function(f,g){this._eachCallback(f,function(i,h){if(i===g){this._callbacks[f].splice(h,1);return true}})};e.prototype._wrapCallback=function(h,f,g){return new d(this,h,f,g)};e.prototype._wrapEvent=function(f){return new a(this,f)};function d(h,i,f,g){c.checkCallback(i);this.emitter=h;this.callback=i;this.eventName=f;this.scope=g&&g.scope?g.scope:undefined;this.once=g?!!g.once:undefined;this.klass=g?!!g.klass:undefined}d.prototype.callIt=function(){var f=Array.prototype.slice.call(arguments);if(this.klass){this.callAsClass(f)}else{this.callAsFunction(f)}if(this.once){this.emitter._removeCallback(this.eventName,this)}};d.prototype.callAsFunction=function(f){this.callback.apply(this.scope,f)};d.prototype.callAsClass=function(g){var h=function(){};h.prototype=this.callback.prototype;var f=new h;this.callback.apply(f,g)};d.prototype.shouldBeFired=function(f){return true};function a(g,f){this.emitter=g;this.eventName=f}a.prototype.shouldFire=function(f){return true};var c={checkEventName:function(f){if(typeof(f)!="string"||!f.match(/^\w+$/i)){throw new Error("Event names must be non-empty word strings.")}},checkCallback:function(f){if(typeof(f)!="function"){throw new Error("Event callbacks must be functions.")}}};b.EventEmitter=e})(this);