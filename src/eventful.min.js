(function(b){function d(){this._callbacks={}}d.prototype.on=function(e,g,f){this._checkEventName(e);if(!this._callbacks[e]){this._callbacks[e]=[]}this._callbacks[e].push(new c(this,g,e,f))};d.prototype.off=function(e,f){this._eachCallback(e,function(h,g){if(h.callback===f){this._callbacks[e].splice(g,1);return false}})};d.prototype.emit=function(e){var f=Array.prototype.slice.call(arguments,1);this._fireCallbacks(new a(this,e),f)};d.prototype._fireCallbacks=function(e,f){this._eachCallback(e.eventName,function(h,g){if(e.shouldFire(h)&&h.shouldBeFired(e)){h.callIt.apply(h,f)}})};d.prototype._eachCallback=function(f,j){if(!this._callbacks[f]){return this}var e=null;var h=this._callbacks[f].length;for(var g=0;g<h;g++){e=j.call(this,this._callbacks[f][g],g);if(e===false){g-=1}else{if(e===true){break}}if(this._callbacks[f].length<=0){return this}}return this};d.prototype._remove=function(e,f){this._eachCallback(e,function(h,g){if(h===f){this._callbacks[e].splice(g,1);return true}})},d.prototype._checkEventName=function(e){if(typeof(e)!="string"||!e.match(/^\w+$/i)){throw new Error("Event names must be non-empty word strings.")}};function c(g,h,e,f){this._checkCallback(h);this.emitter=g;this.callback=h;this.eventName=e;this.scope=f&&f.scope?f.scope:undefined;this.once=f?!!f.once:undefined;this.klass=f?!!f.klass:undefined}c.prototype.callIt=function(){var e=Array.prototype.slice.call(arguments);if(this.klass){this.callAsClass(e)}else{this.callAsFunction(e)}if(this.once){this.emitter._remove(this.eventName,this)}};c.prototype.callAsFunction=function(e){this.callback.apply(this.scope,e)};c.prototype.callAsClass=function(f){var g=function(){};g.prototype=this.callback.prototype;var e=new g;this.callback.apply(e,f)};c.prototype.shouldBeFired=function(e){return this.eventName==e.eventName};c.prototype._checkCallback=function(e){if(typeof(e)!="function"){throw new Error("Event callbacks must be functions.")}};function a(f,e){this.emitter=f;this.eventName=e}a.prototype.shouldFire=function(e){return true};b.EventEmitter=d})(this);