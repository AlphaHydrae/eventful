(function(f){function k(){this._callbacks={}}k.prototype.on=function(l,n,m){d(l);if(!this._callbacks[l]){this._callbacks[l]=[]}this._callbacks[l].push(this._wrapCallback(n,l,m));return this};k.prototype.off=function(l,m){if(typeof(l)=="undefined"){for(var l in this._callbacks){this._removeAllCallbacks(l)}return this}if(!this._callbacks[l]){return this}if(typeof(m)=="undefined"){this._removeAllCallbacks(l);return this}this._eachCallback(l,function(o,n){if(o.callback===m){this._callbacks[l].splice(n,1);return false}});if(this._callbacks[l].length<=0){this._removeAllCallbacks(l)}return this};k.prototype.emit=function(l){var m=Array.prototype.slice.call(arguments,1);this._fireCallbacks(this._wrapEvent(l),m);return this};k.prototype.withNamespace=function(l){return new h(this,l)};k.prototype._fireCallbacks=function(l,m){this._eachCallback(l.eventName,function(o,n){if(l.shouldFire(o)&&o.shouldBeFired(l)){o.callIt.apply(o,m)}})};k.prototype._eachCallback=function(m,q){if(!this._callbacks[m]){return this}var l=null;var p=this._callbacks[m].length;for(var o=0;o<p;o++){l=q.call(this,this._callbacks[m][o],o);if(l===false){o-=1}else{if(l===true){break}}if(this._callbacks[m].length<=0){return this}}return this};k.prototype._removeAllCallbacks=function(l){delete this._callbacks[l]};k.prototype._removeCallback=function(l,m){this._eachCallback(l,function(o,n){if(o===m){this._callbacks[l].splice(n,1);return true}})};k.prototype._wrapCallback=function(n,l,m){return new j(this,n,l,m)};k.prototype._wrapEvent=function(l){return new c(this,l)};function j(n,o,l,m){g(o);this.emitter=n;this.callback=o;this.eventName=l;this.scope=m&&m.scope?m.scope:undefined;this.once=m?!!m.once:undefined;this.klass=m?!!m.klass:undefined}j.prototype.callIt=function(){var l=Array.prototype.slice.call(arguments);if(this.klass){this.callAsClass(l)}else{this.callAsFunction(l)}if(this.once){this.emitter._removeCallback(this.eventName,this)}};j.prototype.callAsFunction=function(l){this.callback.apply(this.scope,l)};j.prototype.callAsClass=function(m){var n=function(){};n.prototype=this.callback.prototype;var l=new n;this.callback.apply(l,m)};j.prototype.shouldBeFired=function(l){return true};function c(m,l){this.emitter=m;this.eventName=l}c.prototype.shouldFire=function(l){return true};function e(){console.log("fubar")}function d(l){if(typeof(l)!="string"||!l.match(/^\w+$/i)){throw new Error("Event names must be non-empty word strings.")}}function g(l){if(typeof(l)!="function"){throw new Error("Event callbacks must be functions.")}}function b(m,l){for(var n in m.prototype){if(n.match(/^_?[a-z]/)){l.prototype[n]=m.prototype[n]}}}function h(m,l){this._emitter=m;this._namespace=l;this._callbacks=this._emitter._callbacks}b(k,h);h.prototype.withNamespace=function(l){return new h(this._emitter,l)};h.prototype._wrapCallback=function(n,l,m){return new a(this._namespace,this,n,l,m)};h.prototype._wrapEvent=function(l){return new i(this._namespace,this,l)};function a(n,o,p,l,m){j.call(this,o,p,l,m);this.namespace=n}b(j,a);a.prototype.shouldBeFired=function(l){return this.namespace==l.namespace};function i(m,n,l){c.call(this,n,l);this.namespace=m}b(c,i);f.EventEmitter=k})(this);